#!usr/bin/python
# -*- coding: UTF-8 -*-
# @Time    : 2020/03/20
# @Author  : 张晓平
import os, yaml, time, datetime, sys

sys.path.append(os.path.split(os.path.abspath(os.path.dirname(__file__)))[0])
from kernel_module.html_report import ReportsOutput

dateArray = datetime.datetime.fromtimestamp(time.time())
cur_path = os.path.abspath(os.path.dirname(__file__))


class FileIo(object):
    def __init__(self):
        self.file_path = os.path.join(
            os.path.split(cur_path)[0],
            "original_data",
            "yaml_template"
        )
        self.current_time = dateArray.strftime("%Y-%m-%d %H:%M:%S")
        self.test_file_path = os.path.join(
            os.path.split(cur_path)[0],
            "original_data",
            "test_data.yaml"
        )

    def file_w_test(self, data,file_path):
        with open(file_path, 'w', encoding="utf-8") as nf:
            yaml.dump(data, nf)

    def file_r(self):
        with open(self.file_path, "r", encoding="utf-8") as f:
            data = yaml.load(f.read())
            return data

    def file_r_test(self):
        with open(self.test_file_path, "r", encoding="utf-8") as f:
            data = yaml.load(f.read())
            return data

    def output(self, reports_path, file_path, html_report_name=None):
        """
        用于跨平台运行的一个思路
        然后读取文件生成报告
        :return:
        """
        with open(file_path, "r", encoding="utf-8") as f:
            data = yaml.load(f.read())
            ReportsOutput().render_html_report(reports_path, data, html_report_name)
        try:
            del_txt = r'del /f /s   ' + file_path + ''
            os.system(del_txt)
        except Exception as e:
            print(e)
